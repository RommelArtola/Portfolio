<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Spotify Analysis of Kendrick Lamar’s Songs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Project_Main_files/libs/clipboard/clipboard.min.js"></script>
<script src="Project_Main_files/libs/quarto-html/quarto.js"></script>
<script src="Project_Main_files/libs/quarto-html/popper.min.js"></script>
<script src="Project_Main_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Project_Main_files/libs/quarto-html/anchor.min.js"></script>
<link href="Project_Main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Project_Main_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Project_Main_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Project_Main_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Project_Main_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spotify Analysis of Kendrick Lamar’s Songs</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introductionabstract" class="level1">
<h1>Introduction/Abstract</h1>
<p>Credits: Rommel Artola &amp; Spotify for providing the API services to extract data! (Thank you Spotify!)</p>
<p>This is a project carried out to show an example of what an entire machine learning project can look from raw start to a finished product and interpretations. Just as one would do in the real world, a considerable amount of code/time is spent on extracting/cleaning/and doing exploratory data analysis (EDA) on the cleaned dataset. At the end, there are several machine learning models that were used to compare the predictability of them, including random forest, multilayer perceptron (MLP) and K-Nearest Neighbors, for example.</p>
<p>This project in particular uses the API from Spotify that allows pulling several data points from songs. In particular, we look at all of Kendrick Lamar’s albums, songs, and a respectable width of audio features like energy, loudmess, speachiness, etc… Additionally, though Spotify provies a ranking of the songs, this ranking has a decay-factor that is affected by time. We try to reverse-engineer this to de-weight the incredible recent popularity of songs like “Not Like Us”.</p>
<p>For our modeling, we ended up manually classifying the datapoints as whether the song was a VERY STRONG favorite, or not so much. There are extremely limitations with this approach, particulary when the dataset ends up not being particularly large.</p>
<p>In the end, the KNN was found to be the best. However, our classification made it so it was not easily-seperable, or not very easily able to generalize, our data. This means there are likely more/different features that could better separate the datasets, like a text-analysis of the lyrics. Though this was not analyzed here.</p>
<p><br><br><br> <em>Important Note: Yes, Kendrick was playing on loop while coding this entire project</em> <br></p>
<pre><code>     O       O//     \O/     \\O       \O/  
    /|\      |        |        |        |   
    / \     / \      / \      / \      / \  
               #TheyNotLikeUs               </code></pre>
<p>Disclaimer: <br> According to Section IV.2.a.i of Spotify’s Policy Restrictions, machine learning models cannot be built using this data. However, this seems to be for the use in specifics to commercial-type products or that is somehow connected with revenue. This project is simply a hobbyist project and is in no way at all, now or in the future, affiliated with any brand, commercial usage, or anything more than an analytical project that may also be used as a way to teach about Python and data science to early-career data scientists.</p>
</section>
<section id="importing-libraries-all" class="level1">
<h1>Importing Libraries (all)</h1>
<div id="a60cdfe4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Used On Multiple Steps</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1. Data Getter</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotipy <span class="im">import</span> Spotify  </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotipy.oauth2 <span class="im">import</span> SpotifyOAuth  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spotipy <span class="im">import</span> SpotifyException</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3. EDA</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> minmax_scale</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: ML</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tkinter <span class="im">import</span> simpledialog</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                             classification_report, </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                             confusion_matrix, </span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                             balanced_accuracy_score</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Extras (Hide Warnings)</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings <span class="co">#used to hide some warnings for cleaner code output.</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tools.sm_exceptions <span class="im">import</span> ConvergenceWarning <span class="im">as</span> statsCW</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.exceptions <span class="im">import</span> ConvergenceWarning <span class="im">as</span> sklearnCW</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span>statsCW)</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span>sklearnCW)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-raw-data-from-spotify-api" class="level1">
<h1>Extracting Raw Data From Spotify API</h1>
<div id="23be810e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in credentials (on .gitignore)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>CLIENT_ID <span class="op">=</span> <span class="bu">open</span>(<span class="st">'client_id.txt'</span>).readline()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>CLIENT_SECRET <span class="op">=</span> <span class="bu">open</span>(<span class="st">'client_secret.txt'</span>).readline()</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>REDIRECT_URI <span class="op">=</span> <span class="st">'https://sites.google.com/view/rommelartola/home/'</span> <span class="co"># My Portfolio site.</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>sp_oauth <span class="op">=</span> SpotifyOAuth(client_id<span class="op">=</span>CLIENT_ID, client_secret<span class="op">=</span>CLIENT_SECRET, redirect_uri<span class="op">=</span>REDIRECT_URI)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>access_token <span class="op">=</span> sp_oauth.get_cached_token()  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sp <span class="op">=</span> Spotify(auth_manager<span class="op">=</span>sp_oauth)  </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Below try block will cycle through all of Kendrick's songs and append the </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># listed values to a dictionary, which will later be convereted to a pandas dataframe</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Another way of doing the same thing could've been a while loop with a += 50 at the </span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">## end of each step. For diagnostics purposes, I prefer try-except blocks many times more.</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    data_dict <span class="op">=</span> {}</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> offset_num <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">10_000</span><span class="op">+</span><span class="dv">50</span>, <span class="dv">50</span>):</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> sp.search(q<span class="op">=</span><span class="st">'artist:Kendrick Lamar'</span>, <span class="bu">type</span><span class="op">=</span><span class="st">'track'</span>, limit<span class="op">=</span><span class="dv">50</span>, offset<span class="op">=</span>offset_num)[<span class="st">'tracks'</span>][<span class="st">'items'</span>]:<span class="co">#.keys()</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'ALBUM_ID'</span>, []).append(i[<span class="st">'album'</span>][<span class="st">'id'</span>])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'ALBUM_NAME'</span>, []).append(i[<span class="st">'album'</span>][<span class="st">'name'</span>])</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'ALBUM_RELEASE_DATE'</span>, []).append(i[<span class="st">'album'</span>][<span class="st">'release_date'</span>])</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'ALBUM_RELEASE_DATE_PRECISION'</span>, []).append(i[<span class="st">'album'</span>][<span class="st">'release_date_precision'</span>])</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_ID'</span>, []).append(i[<span class="st">'id'</span>])</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_NAME'</span>, []).append(i[<span class="st">'name'</span>])</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'EXPLICIT_TRACK'</span>, []).append(i[<span class="st">'explicit'</span>])</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_POPULARITY'</span>, []).append(i[<span class="st">'popularity'</span>])</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_TYPE'</span>, []).append(i[<span class="st">'type'</span>])</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_DURATION_MS'</span>, []).append(i[<span class="st">'duration_ms'</span>])</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Begin Specific Audio Features Per Song ID</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            audio_feat_dict <span class="op">=</span> sp.audio_features(i[<span class="st">'id'</span>])[<span class="dv">0</span>]</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_DANCEABILITY'</span>, []).append(audio_feat_dict[<span class="st">'danceability'</span>])</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_ENERGY'</span>, []).append(audio_feat_dict[<span class="st">'energy'</span>])</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_KEY'</span>, []).append(audio_feat_dict[<span class="st">'key'</span>])</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_LOUDNESS'</span>, []).append(audio_feat_dict[<span class="st">'loudness'</span>])</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_MODE'</span>, []).append(audio_feat_dict[<span class="st">'mode'</span>])</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_SPEACHINESS'</span>, []).append(audio_feat_dict[<span class="st">'speechiness'</span>])</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_ACOUSTICNESS'</span>, []).append(audio_feat_dict[<span class="st">'acousticness'</span>])</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_INSTRUMENTALNESS'</span>, []).append(audio_feat_dict[<span class="st">'instrumentalness'</span>])</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_LIVENESS'</span>, []).append(audio_feat_dict[<span class="st">'liveness'</span>])</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_VALENCE'</span>, []).append(audio_feat_dict[<span class="st">'valence'</span>])</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_TEMPO'</span>, []).append(audio_feat_dict[<span class="st">'tempo'</span>])</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>            data_dict.setdefault(<span class="st">'TRACK_TIME_SIGNATURE'</span>, []).append(audio_feat_dict[<span class="st">'time_signature'</span>])</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> SpotifyException <span class="im">as</span> e:</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Offset Limit Reached: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>raw_df <span class="op">=</span> pd.DataFrame(data_dict)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co"># An error will be returned when the limit is reached. This is the intended behavior.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Offset Limit Reached: http status: 400, code:-1 - https://api.spotify.com/v1/search?q=artist%3AKendrick+Lamar&amp;limit=50&amp;offset=1000&amp;type=track:
 Bad request., reason: None</code></pre>
</div>
</div>
</section>
<section id="cleaning-data" class="level1">
<h1>Cleaning Data</h1>
<p>For our data cleaning we take an unconventional approach and use a class to show how inheretence and object-oriented programming benefits. The sequence in how the methods were built are akin to how the analysis would be performed if just using code cells or indepedent global functions. Another reason why a class was used is because some of the code used here was found to be quite beneficial and was transferred over to my collection of helpful functions for a module I maintain in my professional career.</p>
<p>Granted, this is needlessly difficult, and in a production environment, simply using functions would likely be best since this was a very specific code. If code was more applicable for other uses (perhaps with some parameter change), then a class would make a lot more sense.</p>
<div id="a34d768e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just the class creation</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> K_Dot():</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, df) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> df</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tracks_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.final_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> basics(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">        This basics methods just displays (on jupyter interactive notebook)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">        very high-level summary data. </span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">        Of prime importance is that no null values exist anywhere on any row/columns.</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">        This is a great starting point since we do not have to worry about </span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">        dropping data or data imputation which can oft be hugely</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">        time-consuming.</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        display(<span class="va">self</span>.df.info())</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        display(<span class="va">self</span>.df.describe())</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> col_duplicates(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Another simple summary method that shows the sum of duplicate value </span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">        per columns (axis=1) since the dataframe does not have row-long (axis=0)</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">        duplicates due to specific track IDs.</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">        </span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">        Here, we are fully expect many duplicates on SOME columns, while expecting</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">        no (or very few) duplicates on other columns. For example, we expect MANY</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">        duplicates on albums, but NO duplicates on Track IDs but some duplicates </span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">        on track names, for example. (See docstring as to why this is).</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Grab the max string character count of the df</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        max_len <span class="op">=</span> <span class="bu">max</span>(<span class="bu">len</span>(col) <span class="cf">for</span> col <span class="kw">in</span> <span class="va">self</span>.df.columns)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> <span class="va">self</span>.df.columns:</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">.</span>ljust(max_len)<span class="sc">}</span><span class="ss"> contains</span><span class="ch">\t</span><span class="ss">"</span> <span class="ss">f"</span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>df[col]<span class="sc">.</span>duplicated()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> duplicates"</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> count_duplicates(<span class="va">self</span>, columns:<span class="bu">list</span>[<span class="bu">str</span>]) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co">        This method groups by the desired columns and returns a counter of how</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co">        how many duplicates exist with max rows shown in the pandas display</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="co">        option value.</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="co">        This method was used over various columns and combinations to try and</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="co">        visually identify a pattern of duplicates and see what potentially</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co">        can be dropped or addressed differently.</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> pd.option_context(<span class="st">'display.max_rows'</span>, <span class="va">None</span>):</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>            ret <span class="op">=</span> <span class="va">self</span>.df.groupby(columns)<span class="op">\</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                    .size()<span class="op">\</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                    .reset_index(name<span class="op">=</span><span class="st">'Counter'</span>)<span class="op">\</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>                    .sort_values(by<span class="op">=</span><span class="st">'Counter'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>            <span class="co">#display(ret)</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span>(ret)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> multi_query(<span class="va">self</span>, </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>                       columns:<span class="bu">list</span>[<span class="bu">str</span>], </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                       operators:<span class="bu">list</span>[<span class="bu">str</span>],</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                       search_val:<span class="bu">list</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a><span class="co">        This method was put together more as a challenge than anything. </span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a><span class="co">        It would've been easier to manually type these string query by hand,</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a><span class="co">        but I saw a lot of value in creating this function I hadn't seen before</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="co">        since I see applicability in my day-to-day work for analysis as well.</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a><span class="co">        With that said, this method takes 3 lists of strings which are:</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="co">        columns: The columns in the dataframe you want to pd.query()</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="co">        operators: The matching operators that will be used on the columns</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a><span class="co">        search_val: The value you will be looking for in the columns. </span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="co">        For example, say you had an infinite dataframe with at least day of week</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a><span class="co">        like (Sunday - Saturday), weather forecast (Sunny, Rainy, etc...)</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="co">        and how many miles (int) you drove your vehicle that day.. then:</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt; columns = ['DAY_OF_WEEK', 'FORECAST', 'MILES_DRIVEN]</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt; operators = ['==', '==', '&gt;=']</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt; search_val = ['Sunday', 'Sunny', 30]</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="co">        &gt;&gt; self.multi_query(columns=columns, operators=operatorsm search_val=search_val)</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> <span class="bu">len</span>(columns) <span class="op">==</span> <span class="bu">len</span>(operators) <span class="op">==</span> <span class="bu">len</span>(search_val), (</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>                <span class="st">"All parameters must be equal in length</span><span class="ch">\n</span><span class="st">"</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Length columns: </span><span class="sc">{</span><span class="bu">len</span>(columns)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Length operators: </span><span class="sc">{</span><span class="bu">len</span>(operators)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f"Length search_val: </span><span class="sc">{</span><span class="bu">len</span>(search_val)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        conditions <span class="op">=</span> []</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col, op, search <span class="kw">in</span> <span class="bu">zip</span>(columns, operators, search_val):</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(search, <span class="bu">str</span>):</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>                conditions.append(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>op<span class="sc">}</span><span class="ss"> </span><span class="ch">\"</span><span class="sc">{</span>search<span class="sc">}</span><span class="ch">\"</span><span class="ss">"</span>)</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>                conditions.append(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>op<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>search<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>        query_str <span class="op">=</span> <span class="st">" and "</span>.join(conditions)</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.df.query(query_str)</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> drop_non_explicits(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a><span class="co">        It seems like the prime issues are duplicated albums (like collector's editions),</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="co">        and other entries like "Best of 2017 Hip Hop" for example, that house the same track.</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a><span class="co">        For this, we will have to aggregate our values. Additionally, it seems that</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a><span class="co">        storing the track as an explicit version and non-explicit version of course also</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a><span class="co">        create two different entries. The latter is what we will address in this method.</span></span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a><span class="co">        For simplicity, and because I'm relatively familiar with Kendrick's "true" music,</span></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a><span class="co">        I will remove all non-explicit songs.</span></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.df <span class="op">=</span> <span class="va">self</span>.df.query(<span class="st">'EXPLICIT_TRACK == True'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> seperate_albums_and_tracks(<span class="va">self</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a><span class="co">        The easiest way to address the issue of random album names (not the True names),</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a><span class="co">        we are going to: </span></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a><span class="co">            1) Split album names from track names as two seperate dfs,</span></span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a><span class="co">            2) clean up album dataframe by manually dropping the non-original ones</span></span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a><span class="co">            3) Cleaning up track df by aggregating where it makes sense (manual)</span></span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a><span class="co">            4) Joining back together.</span></span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df <span class="op">=</span> <span class="va">self</span>.df[[<span class="st">'ALBUM_ID'</span>, <span class="st">'ALBUM_NAME'</span>, <span class="st">'ALBUM_RELEASE_DATE'</span>,</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'ALBUM_RELEASE_DATE_PRECISION'</span>, <span class="st">'TRACK_ID'</span>]]</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tracks_df <span class="op">=</span> <span class="va">self</span>.df.iloc[:, <span class="dv">4</span>:]</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_albums(<span class="va">self</span>, keep_these_albums:<span class="bu">list</span>[<span class="bu">str</span>], </span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>                     drop_column:<span class="bu">list</span>[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">'ALBUM_RELEASE_DATE_PRECISION'</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df <span class="op">=</span> <span class="va">self</span>.albums_df[<span class="va">self</span>.albums_df[<span class="st">'ALBUM_NAME'</span>].isin(keep_these_albums)]</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Everything looks good at this point for albums, when I ran the below</span></span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>        <span class="co">#kdot.albums_df[['ALBUM_NAME', 'ALBUM_RELEASE_DATE']].drop_duplicates()</span></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The issue is that GKMC is missing the full release date, so I will manually</span></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># override that with the correct date.</span></span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Default column dropped because the value would become a constant value of 'day'</span></span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df.loc[<span class="va">self</span>.albums_df[<span class="st">'ALBUM_NAME'</span>] <span class="op">==</span> <span class="st">'good kid, m.A.A.d city'</span>, <span class="st">'ALBUM_RELEASE_DATE'</span>] <span class="op">=</span> <span class="st">'2012-10-22'</span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df[<span class="st">'ALBUM_RELEASE_DATE'</span>] <span class="op">=</span> pd.to_datetime(<span class="va">self</span>.albums_df[<span class="st">'ALBUM_RELEASE_DATE'</span>])</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Below we want to convert the album release date as a fractional (decimal)</span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># value so we can perform regression on it as a continuous variable.</span></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 365.25 is used to account for leap year.</span></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># For easier coding, we're going to make the column into a variable instead of calling it </span></span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># several times</span></span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>        date_col <span class="op">=</span> <span class="va">self</span>.albums_df[<span class="st">'ALBUM_RELEASE_DATE'</span>]</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df[<span class="st">'ALBUM_FRACTIONAL_DATE'</span>] <span class="op">=\</span></span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>                    date_col.dt.year <span class="op">+\</span></span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>                    (date_col <span class="op">-</span> pd.to_datetime(date_col.dt.year, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y'</span>)).dt.days <span class="op">/</span> <span class="dv">365</span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.albums_df <span class="op">=</span> <span class="va">self</span>.albums_df.drop(columns<span class="op">=</span>drop_column)</span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># I believe albums are cleaned up at this point. Let's head to tracks now.</span></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> clean_tracks(<span class="va">self</span>, col_drops:<span class="bu">list</span>[<span class="bu">str</span>] <span class="op">=</span> [<span class="st">'EXPLICIT_TRACK'</span>, <span class="st">'TRACK_TYPE'</span>]) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>        <span class="co">#The default columns are dropped because they're constant values</span></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.tracks_df <span class="op">=</span> <span class="va">self</span>.tracks_df.drop(columns<span class="op">=</span>col_drops)</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>        <span class="co">#Looks like after cleaning up the albums, nothing really needs to be</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cleaned up in the tracks AFTER we inner join. Let's do that now as</span></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a seperate method.</span></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> join_albums_and_tracks(<span class="va">self</span>, how:<span class="bu">str</span><span class="op">=</span><span class="st">'inner'</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.final_df <span class="op">=</span> pd.merge(left<span class="op">=</span><span class="va">self</span>.albums_df,</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>                                 right<span class="op">=</span><span class="va">self</span>.tracks_df,</span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>                                    on<span class="op">=</span><span class="st">'TRACK_ID'</span>,</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>                                    how<span class="op">=</span>how)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4ea32613" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The Actual Cleaning Code. Refer to the Methods to see what they are actually doing</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>kdot <span class="op">=</span> K_Dot(raw_df)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>kdot.drop_non_explicits()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>kdot.df.shape <span class="co">#This now brings us to a shape of (195, 22), down from (297,22)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># With that said, it looks like HUMBLE. has 8 duplicates, as our most-reapeated one, </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#for example. Let's dig into that particular one a bit more using the count duplica</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>duplicated_songs <span class="op">=</span> <span class="bu">list</span>(kdot.count_duplicates(<span class="st">'TRACK_NAME'</span>).query(<span class="st">"Counter &gt; 1"</span>)[<span class="st">'TRACK_NAME'</span>])</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>kdot.seperate_albums_and_tracks()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>og_albums <span class="op">=</span> [<span class="st">'To Pimp A Butterfly'</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Mr. Morale &amp; The Big Steppers'</span>, <span class="st">'meet the grahams'</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Not Like Us'</span>, <span class="st">'Section.80'</span>, <span class="st">'DAMN.'</span>, <span class="st">'euphoria'</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">'untitled unmastered.'</span>, <span class="st">'good kid, m.A.A.d city'</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Overly Dedicated'</span>]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>kdot.clean_albums(keep_these_albums<span class="op">=</span>og_albums)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>kdot.clean_tracks()</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>kdot.join_albums_and_tracks()</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>cleaned_df <span class="op">=</span> kdot.final_df.copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploratory-data-analysis-eda" class="level1">
<h1>Exploratory Data Analysis (EDA)</h1>
<p>By far the most code-heavy section. These were done in chunks, so will seperate by cells in the notebook here. We technically also do some data cleaning/transformation in here – particularly, transforming the Spotify’s track popularity with an attempt of removing the decay factor.</p>
<div id="2f59a140" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(cleaned_df, kind<span class="op">=</span><span class="st">'scatter'</span>, diag_kind<span class="op">=</span><span class="st">'kde'</span>)<span class="co">#.savefig('Outputs/01_pairplot.png')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-6-output-1.png" width="3533" height="3529" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The pairplot above has A LOT of information, so let’s break down what it is that we are seeing.</p>
<p>Feature Analysis: - TRACK_TIME_SIGNATURE: An overwhelming amount of K Dot’s songs are in a value of 4 for this feature. Which the definition is: - &gt;“An estimated time signature. The time signature (meter) is a notational convention to specify how many beats are in each bar (or measure). The time signature ranges from 3 to 7 indicating time signatures of”3/4”, to “7/4”.”</p>
<ul>
<li><p>For Kendrick, this means there are 4 beats in each measure and a quarter note receives one count. According to https://www.skoove.com/, they say that a:</p></li>
<li><p>Skoove: “4/4 time signature gives music a steady, marching rhythm, perfect for getting your foot tapping.”</p></li>
<li><p>TRACK_TEMPO: When looking at tempo and duration, it seems that the much longer songs of K Dot tend to be in lower tempo, which makes sense. His longer songs tend to be more poetically-inclined and are of spoken-word instead of something like Money Trees for example.</p></li>
<li><p>TRACK_DANCEABILITY: For danceability, the middle ground of tempo seems to be the best.</p>
<ul>
<li>Overall, nothing too great here, even the aformentioned call outs, are sparse and not very linear/direct. So, they are to be taken with a grain of salt. The biggest value is that, by looking at the kernel density plot, most of his songs are slower tempo, hence the plot is right-skewed a bit.</li>
</ul></li>
<li><p>TRACK_VALENCE: I just want to call out, this is probably my favorite measure because it algorithmically places a valuue on how positive the song is based on the tone. As Spotify calls out in the documentation: “Tracks with high valence sound more positive (e.g.&nbsp;happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g.&nbsp;sad, depressed, angry)”</p>
<ul>
<li><p>When looking at popularity it seems to have a relatively strong linear relationship with “happier” songs being more popular. With a couple songs being VERY popular and low valence.</p></li>
<li><p>Valence distribution is overall pretty normal. But nothing else to note.</p></li>
</ul></li>
<li><p>TRACK_LOUDSNESS &amp; TRACK_ENERGY: Both seem VERY positively correlated to each other.</p></li>
<li><p>TRACK_POPULARITY: What is a little troublesome, is that popularity is a mathematical value that decreases over time. Let’s see if we can reverse-engineer some of that logic in the later code.</p></li>
</ul>
<div id="43a9e356" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's now boil the ocean again, but instead of a graphical view, let's do a </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># numerical representation using a correlation matrix.</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cleaned_df.corr(numeric_only<span class="op">=</span><span class="va">True</span>), annot<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            linecolor<span class="op">=</span><span class="st">'black'</span>, cmap<span class="op">=</span><span class="st">'RdYlBu'</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            linewidths<span class="op">=</span><span class="fl">0.5</span>,  fmt<span class="op">=</span><span class="st">".2f"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, center<span class="op">=</span><span class="dv">0</span>,        </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">14</span>})</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlation plot of K Dot'</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("Outputs/02_corrplot.png")</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-7-output-1.png" width="1606" height="1716" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What is all of that mess even showing besides pretty squares..?</p>
<p>Well, in summary, it is showing that the below relationships are very strongly-related:</p>
<ul>
<li>ALBUM_FRACTIONAL_DATE and TRACK_POPULARITY: As we would expect with his most-recent drops</li>
<li>TRACK_ENERGY and TRACK_LOUDNESS: As we had called out earlier.</li>
<li>Both of the above are positive correlations.</li>
</ul>
<p>Weaker, but worth calling out (negative) correlations: - TRACK_ENERGY and ALBUM_FRACTIONAL_DATE: Looks like K Dot has a negative trend on ‘energy’ (no pun intended) - TRACK_SPEACHINESS and TRACK_POPULARITY: Very ‘speachie’ tracks are less popular, BUT this makes A LOT of sense because his more speachie songs are also much longer and tend to be more poetery/spoken word than a hype song.</p>
<p>Nothing else exceptional.</p>
<div id="27239f3e" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's reverse-engineer some of the algorithmicness of popularity.</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We will do this with the consideration that Money Trees and Not Like Us should</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   have a similar value in popularity, much closer than what is currently showing. </span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or at the very least, Not Like Us should NOT be THAT much popular just because of</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># recency.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This will be done using a modified anti-decay factor/function.</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a modified exponential decay function</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> antidecay_function(decayed_value, rate_of_decrease, time):</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Where:</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">        a = Initial Amount</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">        r = Rate of Decrease</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">        t = Time</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">        a = &gt; 0</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">        r = between 0 and 1 (non-inclusive)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">        d = output (decyaed value)</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Original function to give the decay value is:</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">        d = a(1 - r)**t</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">    For us, it'll be:</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">        a = d / ( (1 - r)**t )</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> decayed_value <span class="op">/</span> ( (<span class="dv">1</span> <span class="op">-</span> rate_of_decrease) <span class="op">**</span> time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="4eca5dba" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>today <span class="op">=</span> pd.to_datetime(datetime.now().date())</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cleaned_df[<span class="st">'DAYS_SINCE_RELEASE'</span>] <span class="op">=</span> today <span class="op">-</span> cleaned_df[<span class="st">'ALBUM_RELEASE_DATE'</span>]</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cleaned_df[<span class="st">'SCALED_DAYS_SINCE_RELEASE'</span>] <span class="op">=</span> minmax_scale(cleaned_df[[<span class="st">'DAYS_SINCE_RELEASE'</span>]])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>cleaned_df[[<span class="st">'TRACK_NAME'</span>, <span class="st">'DAYS_SINCE_RELEASE'</span>, <span class="st">'SCALED_DAYS_SINCE_RELEASE'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TRACK_NAME</th>
<th data-quarto-table-cell-role="th">DAYS_SINCE_RELEASE</th>
<th data-quarto-table-cell-role="th">SCALED_DAYS_SINCE_RELEASE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>We Cry Together</td>
<td>772 days</td>
<td>0.144951</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Not Like Us</td>
<td>50 days</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>euphoria</td>
<td>54 days</td>
<td>0.000803</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>HiiiPower</td>
<td>4740 days</td>
<td>0.941578</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>meet the grahams</td>
<td>51 days</td>
<td>0.000201</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="5869800a" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we will use an iterative approach</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>best_rate <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>lowest_RMSD <span class="op">=</span> np.inf </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">.01</span>):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    cleaned_df[<span class="st">'ANTI_DECAY_POPULARITY'</span>] <span class="op">=</span> antidecay_function(decayed_value<span class="op">=</span>cleaned_df[<span class="st">'TRACK_POPULARITY'</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                                                     rate_of_decrease<span class="op">=</span>i,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                                     time<span class="op">=</span>cleaned_df[<span class="st">'SCALED_DAYS_SINCE_RELEASE'</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    cleaned_df[<span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>] <span class="op">=</span> minmax_scale(cleaned_df[[<span class="st">'ANTI_DECAY_POPULARITY'</span>]])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#root mean square deviation (broken out for better reading)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#grab mean value first for distance</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    mean_val <span class="op">=</span> cleaned_df[<span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>].mean()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#square the distances</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    squared_distances <span class="op">=</span> (cleaned_df[<span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>] <span class="op">-</span> mean_val)<span class="op">**</span><span class="dv">2</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Average distances and square root.</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">#We want to minimize this value to find our ideal rate of decrease.</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    RMSD <span class="op">=</span> np.sqrt(squared_distances.mean())</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> RMSD <span class="op">&lt;</span> lowest_RMSD:</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        lowest_RMSD <span class="op">=</span> RMSD</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        best_rate <span class="op">=</span> i</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'New best rate found! </span><span class="sc">{</span>best_rate<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plots Comment out. They are histograms, and we are trying to find the most "normal".</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.hist(cleaned_df['SCALED_ANTIDECAY_POPULARITY'])</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.title(f'Rate of Decrease: {i}.\nRMSD: {RMSD}')</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.show()</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Lowest RMSD: </span><span class="sc">{</span>lowest_RMSD<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Best Rate of Decay: </span><span class="sc">{</span>best_rate<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>New best rate found! 0.1
New best rate found! 0.34999999999999987
New best rate found! 0.4199999999999998
New best rate found! 0.4299999999999998
New best rate found! 0.43999999999999984
New best rate found! 0.44999999999999984
New best rate found! 0.45999999999999985
New best rate found! 0.46999999999999986
New best rate found! 0.47999999999999976
Lowest RMSD: 0.2114381640282861
Best Rate of Decay: 0.47999999999999976</code></pre>
</div>
</div>
<p>Looks like we found our best rate of decay to reduce the room mean square difference from mean! Let’s cement these findings in our columns now.</p>
<div id="12e3d0ca" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cleaned_df[<span class="st">'ANTI_DECAY_POPULARITY'</span>] <span class="op">=</span> antidecay_function(decayed_value<span class="op">=</span>cleaned_df[<span class="st">'TRACK_POPULARITY'</span>],</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                                                     rate_of_decrease<span class="op">=</span>best_rate, <span class="co">#.14</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                                     time<span class="op">=</span>cleaned_df[<span class="st">'SCALED_DAYS_SINCE_RELEASE'</span>])</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>cleaned_df[<span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>] <span class="op">=</span> minmax_scale(cleaned_df[[<span class="st">'ANTI_DECAY_POPULARITY'</span>]]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's take a look at how our songs were ranked with our new values.</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_rows'</span>, <span class="dv">100</span>):</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    display(cleaned_df[[<span class="st">'ALBUM_NAME'</span>, <span class="st">'TRACK_NAME'</span>, <span class="st">'TRACK_POPULARITY'</span>, <span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>]].sort_values(by<span class="op">=</span><span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ALBUM_NAME</th>
<th data-quarto-table-cell-role="th">TRACK_NAME</th>
<th data-quarto-table-cell-role="th">TRACK_POPULARITY</th>
<th data-quarto-table-cell-role="th">SCALED_ANTIDECAY_POPULARITY</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>good kid, m.A.A.d city</td>
<td>Money Trees</td>
<td>77</td>
<td>100.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Section.80</td>
<td>A.D.H.D</td>
<td>70</td>
<td>93.977070</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>To Pimp A Butterfly</td>
<td>Alright</td>
<td>77</td>
<td>79.594970</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>good kid, m.A.A.d city</td>
<td>Bitch, Don’t Kill My Vibe</td>
<td>68</td>
<td>78.022701</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>DAMN.</td>
<td>HUMBLE.</td>
<td>82</td>
<td>73.528526</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Section.80</td>
<td>HiiiPower</td>
<td>62</td>
<td>73.176490</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>Section.80</td>
<td>Hol' Up</td>
<td>61</td>
<td>70.576417</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>Section.80</td>
<td>Chapter Six</td>
<td>61</td>
<td>70.576417</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>DAMN.</td>
<td>PRIDE.</td>
<td>80</td>
<td>69.588123</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>DAMN.</td>
<td>LOVE. FEAT. ZACARI.</td>
<td>80</td>
<td>69.588123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>To Pimp A Butterfly</td>
<td>King Kunta</td>
<td>72</td>
<td>68.710362</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">36</td>
<td>good kid, m.A.A.d city</td>
<td>m.A.A.d city</td>
<td>63</td>
<td>65.813090</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Section.80</td>
<td>Rigamortus</td>
<td>59</td>
<td>65.376272</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>DAMN.</td>
<td>DNA.</td>
<td>77</td>
<td>63.677518</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>To Pimp A Butterfly</td>
<td>Wesley's Theory</td>
<td>69</td>
<td>62.179596</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>Section.80</td>
<td>Blow My High (Members Only)</td>
<td>57</td>
<td>60.176127</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>DAMN.</td>
<td>LOYALTY. FEAT. RIHANNA.</td>
<td>74</td>
<td>57.766913</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>To Pimp A Butterfly</td>
<td>These Walls</td>
<td>65</td>
<td>53.471910</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>Section.80</td>
<td>Poe Mans Dreams (His Vice) (feat. GLC)</td>
<td>54</td>
<td>52.375910</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>DAMN.</td>
<td>DUCKWORTH.</td>
<td>70</td>
<td>49.886107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72</td>
<td>Section.80</td>
<td>F*ck Your Ethnicity</td>
<td>53</td>
<td>49.775838</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">58</td>
<td>Section.80</td>
<td>Ronald Reagan Era</td>
<td>52</td>
<td>47.175765</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">78</td>
<td>Overly Dedicated</td>
<td>Ignorance Is Bliss</td>
<td>50</td>
<td>47.038330</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>To Pimp A Butterfly</td>
<td>i</td>
<td>62</td>
<td>46.941144</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>DAMN.</td>
<td>ELEMENT.</td>
<td>68</td>
<td>45.945704</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">46</td>
<td>To Pimp A Butterfly</td>
<td>How Much A Dollar Cost</td>
<td>61</td>
<td>44.764223</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>To Pimp A Butterfly</td>
<td>Institutionalized</td>
<td>61</td>
<td>44.764223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">77</td>
<td>Overly Dedicated</td>
<td>She Needs Me (Remix)</td>
<td>49</td>
<td>44.337004</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">98</td>
<td>Overly Dedicated</td>
<td>Barbed Wire</td>
<td>49</td>
<td>44.337004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>untitled unmastered.</td>
<td>untitled 08 | 09.06.2014.</td>
<td>63</td>
<td>42.890100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Not Like Us</td>
<td>Not Like Us</td>
<td>93</td>
<td>42.608154</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>To Pimp A Butterfly</td>
<td>The Blacker The Berry</td>
<td>60</td>
<td>42.587301</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>To Pimp A Butterfly</td>
<td>u</td>
<td>60</td>
<td>42.587301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>DAMN.</td>
<td>XXX. FEAT. U2.</td>
<td>66</td>
<td>42.005301</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">86</td>
<td>Section.80</td>
<td>Keisha's Song (Her Pain) (feat. Ashtro Bot)</td>
<td>50</td>
<td>41.975620</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">70</td>
<td>Section.80</td>
<td>Tammy's Song (Her Evils)</td>
<td>50</td>
<td>41.975620</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">76</td>
<td>Overly Dedicated</td>
<td>Opposites Attract (Tomorrow W/O Her)</td>
<td>48</td>
<td>41.635677</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">81</td>
<td>Overly Dedicated</td>
<td>P&amp;P 1.5</td>
<td>48</td>
<td>41.635677</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>To Pimp A Butterfly</td>
<td>Hood Politics</td>
<td>59</td>
<td>40.410379</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>DAMN.</td>
<td>YAH.</td>
<td>65</td>
<td>40.035099</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>DAMN.</td>
<td>FEEL.</td>
<td>65</td>
<td>40.035099</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">84</td>
<td>Section.80</td>
<td>Kush &amp; Corinthians (feat. BJ The Chicago Kid)</td>
<td>49</td>
<td>39.375548</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">85</td>
<td>Overly Dedicated</td>
<td>Growing Apart (To Get Closer)</td>
<td>47</td>
<td>38.934350</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50</td>
<td>To Pimp A Butterfly</td>
<td>You Ain't Gotta Lie (Momma Said)</td>
<td>58</td>
<td>38.233457</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>DAMN.</td>
<td>FEAR.</td>
<td>64</td>
<td>38.064897</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>Section.80</td>
<td>No Make-Up (Her Vice) (feat. Colin Munroe)</td>
<td>48</td>
<td>36.775475</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">71</td>
<td>good kid, m.A.A.d city</td>
<td>Poetic Justice</td>
<td>51</td>
<td>36.510025</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">65</td>
<td>good kid, m.A.A.d city</td>
<td>Backseat Freestyle</td>
<td>51</td>
<td>36.510025</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">93</td>
<td>Overly Dedicated</td>
<td>Alien Girl (Today W/ Her)</td>
<td>46</td>
<td>36.233023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">30</td>
<td>DAMN.</td>
<td>LUST.</td>
<td>63</td>
<td>36.094696</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">62</td>
<td>To Pimp A Butterfly</td>
<td>Complexion (A Zulu Love)</td>
<td>57</td>
<td>36.056536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">68</td>
<td>To Pimp A Butterfly</td>
<td>For Free? - Interlude</td>
<td>57</td>
<td>36.056536</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">47</td>
<td>To Pimp A Butterfly</td>
<td>Momma</td>
<td>57</td>
<td>36.056536</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">44</td>
<td>untitled unmastered.</td>
<td>untitled 02 | 06.23.2014.</td>
<td>59</td>
<td>34.577839</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">73</td>
<td>DAMN.</td>
<td>BLOOD.</td>
<td>62</td>
<td>34.124494</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>To Pimp A Butterfly</td>
<td>Mortal Man</td>
<td>56</td>
<td>33.879614</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">74</td>
<td>To Pimp A Butterfly</td>
<td>For Sale? - Interlude</td>
<td>56</td>
<td>33.879614</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">80</td>
<td>Overly Dedicated</td>
<td>Average Joe</td>
<td>45</td>
<td>33.531697</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>euphoria</td>
<td>euphoria</td>
<td>86</td>
<td>32.838780</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">91</td>
<td>Section.80</td>
<td>Chapter Ten</td>
<td>46</td>
<td>31.575330</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75</td>
<td>Overly Dedicated</td>
<td>Cut You Off (To Grow Closer)</td>
<td>44</td>
<td>30.830370</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">83</td>
<td>Overly Dedicated</td>
<td>H.O.C</td>
<td>44</td>
<td>30.830370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">49</td>
<td>DAMN.</td>
<td>GOD.</td>
<td>60</td>
<td>30.184091</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">64</td>
<td>good kid, m.A.A.d city</td>
<td>Swimming Pools (Drank) - Extended Version</td>
<td>48</td>
<td>29.184258</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">99</td>
<td>Section.80</td>
<td>Ab-Souls Outro (feat. Ab-Soul)</td>
<td>45</td>
<td>28.975258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">79</td>
<td>Overly Dedicated</td>
<td>Michael Jordan</td>
<td>43</td>
<td>28.129043</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>N95</td>
<td>75</td>
<td>27.798317</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">59</td>
<td>good kid, m.A.A.d city</td>
<td>Sing About Me, I'm Dying Of Thirst</td>
<td>47</td>
<td>26.742336</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">43</td>
<td>untitled unmastered.</td>
<td>untitled 06 | 06.30.2014.</td>
<td>55</td>
<td>26.265579</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">82</td>
<td>Overly Dedicated</td>
<td>R.O.T.C (Interlude)</td>
<td>42</td>
<td>25.427717</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Count Me Out</td>
<td>73</td>
<td>24.709615</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>meet the grahams</td>
<td>meet the grahams</td>
<td>80</td>
<td>24.361940</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>untitled unmastered.</td>
<td>untitled 05 | 09.21.2014.</td>
<td>54</td>
<td>24.187513</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">53</td>
<td>untitled unmastered.</td>
<td>untitled 03 | 05.28.2013.</td>
<td>54</td>
<td>24.187513</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">31</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>United In Grief</td>
<td>72</td>
<td>23.165264</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Rich Spirit</td>
<td>72</td>
<td>23.165264</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Die Hard</td>
<td>72</td>
<td>23.165264</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">42</td>
<td>untitled unmastered.</td>
<td>untitled 07 | 2014 - 2016</td>
<td>53</td>
<td>22.109448</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">89</td>
<td>good kid, m.A.A.d city</td>
<td>The Art of Peer Pressure</td>
<td>45</td>
<td>21.858492</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">95</td>
<td>good kid, m.A.A.d city</td>
<td>good kid</td>
<td>45</td>
<td>21.858492</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Father Time (feat. Sampha)</td>
<td>68</td>
<td>16.987860</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">92</td>
<td>good kid, m.A.A.d city</td>
<td>Real</td>
<td>43</td>
<td>16.974648</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">97</td>
<td>good kid, m.A.A.d city</td>
<td>Sherane a.k.a Master Splinter’s Daughter</td>
<td>43</td>
<td>16.974648</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">96</td>
<td>good kid, m.A.A.d city</td>
<td>Compton</td>
<td>42</td>
<td>14.532726</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Silent Hill</td>
<td>65</td>
<td>12.354808</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">88</td>
<td>untitled unmastered.</td>
<td>untitled 01 | 08.19.2014.</td>
<td>48</td>
<td>11.719123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">90</td>
<td>good kid, m.A.A.d city</td>
<td>Bitch, Don’t Kill My Vibe - Remix</td>
<td>40</td>
<td>9.648881</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">87</td>
<td>untitled unmastered.</td>
<td>untitled 04 | 08.14.2014.</td>
<td>47</td>
<td>9.641058</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">27</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Savior</td>
<td>63</td>
<td>9.266106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>We Cry Together</td>
<td>62</td>
<td>7.721755</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Purple Hearts</td>
<td>62</td>
<td>7.721755</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Mr. Morale</td>
<td>61</td>
<td>6.177404</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">52</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Mirror</td>
<td>61</td>
<td>6.177404</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">38</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>The Heart Part 5</td>
<td>60</td>
<td>4.633053</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">61</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Worldwide Steppers</td>
<td>60</td>
<td>4.633053</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">54</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Mother I Sober (feat. Beth Gibbons of Portishead)</td>
<td>58</td>
<td>1.544351</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">69</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Crown</td>
<td>58</td>
<td>1.544351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">67</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Savior - Interlude</td>
<td>57</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">57</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Auntie Diaries</td>
<td>57</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">63</td>
<td>Mr. Morale &amp; The Big Steppers</td>
<td>Rich - Interlude</td>
<td>57</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="section-takeaway" class="level3">
<h3 class="anchored" data-anchor-id="section-takeaway">Section Takeaway:</h3>
<p>Though it reduces the score of Not Like Us, for example, by A LOT simply because it’s much too new when compared to something like Money Trees, I can’t say I entirely disagree with the new values.</p>
<p>A similar metric could’ve been achieved with total play counts I believe, and arriving to another mathematical way of popularity, but I think this way makes sense.</p>
<p>What was surprising to me, was how his album “Mr.&nbsp;Morale &amp; The Big Steppers” (MMTBS) was basically clustered all the way to the bottom of lowest popularity. I imagine this must be, in part, because MMTBS is not very old when looking at albums like GKMC. Additionally, some people hint at MMTBS having been “a flop” in commercial terms.</p>
<p>What I certainly do not agree with (on the original popularity ranking) is how albums were being clustered and sorted almost just by how old they were instead of their actual popularity, grossly misidentifying the most-popular songs. I think the new value we’ve arrived at does a strong job of identifying truly popular songs, but harshly punishes songs that are relatively recent AND NOT highly popular.</p>
<p>This gives me confidence to preceed with our new popularity ranking.</p>
<div id="d83d11c6" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">20</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num, i <span class="kw">in</span> <span class="bu">enumerate</span>(cleaned_df.select_dtypes(include<span class="op">=</span>[<span class="st">'int'</span>, <span class="st">'float'</span>]), start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">6</span>, <span class="dv">3</span>, num)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    plt.hist(cleaned_df[i], density<span class="op">=</span><span class="va">True</span>, label<span class="op">=</span><span class="bu">str</span>(i))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="bu">str</span>(i))</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-12-output-1.png" width="1546" height="1552" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Above is a simple histogram plot of each numeric column from the dataset.</p>
<p>Nothing <sub>too</sub> critical. Namely, Kendrick’s track danceability seem to follow a relatively normal distribution, while his songs tend to lean towards loud and his acousticness and liveness tend to not be very high.</p>
<p>Additionally, most of his songs fall between the 200K - 300K MS duration. Though, a few songs have a much longer duration of more than double that.</p>
<p>However, now we can see the visual transformation from the raw (originall) track popularity to our anti-decay value, and finally our scaled anti-decay value to bring it back into a range of 0-100.</p>
<p>So, now it’s worth calling out for consistency, that the SCALED_ANTIDECAY_POPULARITY is not a relative value. I.e., a value of 0 is that the song has never been listened to, it’s just showing: “This is the least popular song of K Dot’s discography, when accounting for the amount of days the song has been released using the decay function.”</p>
<div id="a8481476" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lm_plot <span class="op">=</span> sns.lmplot(data<span class="op">=</span>cleaned_df, x<span class="op">=</span><span class="st">'TRACK_DURATION_MS'</span>, </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                     y<span class="op">=</span><span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                     hue<span class="op">=</span><span class="st">'ALBUM_NAME'</span>, ci<span class="op">=</span><span class="dv">10</span>, robust<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>lm_plot.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Track's Duration Effect on Calculated Popularity</span><span class="ch">\n</span><span class="st">With Robust Regression Per Album"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.figtext(<span class="fl">0.1</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="st">'Footnote: C.I. = 10'</span>, wrap<span class="op">=</span><span class="va">True</span>, horizontalalignment<span class="op">=</span><span class="st">'left'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-13-output-1.png" width="694" height="574" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What are seeing in the plot above? Well, a lot of extrapolation on very few data points, but an interesting extrapolation nonetheless. Naturally, there are going to be outliers within-albums, so we use a Robust regression to de-weight those outliers a bit.</p>
<p>We also only use a very small confidence interval of 10 to not overcrowd the plot with data.</p>
<p>What I find the most interesting is that the album “untitled unmastered.” has an upward trend for track duration while “DAMN.” has a negative fit for track duration. Now, kee in mind “DAMN.” was released mid 2017, while “untitled unmastered” was released early 2016. So, not a whole lot of difference I would imagine for the popularity reversal using the decay function to affect it. Even then, we are looking at the within-album trend instead of the between-album trend. Which should be controlling for that difference anyway since each album has the same days since release, and the other difference would be the original popularity we transformed.</p>
<div id="74d2986c" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check the release dates here</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>cleaned_df[cleaned_df[<span class="st">'ALBUM_NAME'</span>].<span class="bu">str</span>.contains(<span class="st">'untitled|DAMN.'</span>)]<span class="op">\</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   .get([<span class="st">'ALBUM_NAME'</span>, <span class="st">'ALBUM_RELEASE_DATE'</span>])<span class="op">\</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>   .drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ALBUM_NAME</th>
<th data-quarto-table-cell-role="th">ALBUM_RELEASE_DATE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>DAMN.</td>
<td>2017-04-14</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>untitled unmastered.</td>
<td>2016-03-04</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What is the opinion of this?</p>
<p>The “DAMN.” album, having won the Pulitzer Prize, likely attracted A LOT of love from Kendrick’s non-core audience. Likely some folks that just wanted to listen to the hottest songs, or at least not the longest ones. In the other hand, “untitled unmastered.” targets K Dot’s core audiance in the heart of hearts. His poetic spoken-word approach with a grungy-type feeling filled with mystery appeals more to those folks, that want to stick around for the longer songs to learn about Kendrick. Additionally, just the fact alone that the album’s name is “untitled unmastered” and all of the tracks are “untitled ## ..” goes to show what audience he made it for, or at least had in mind.</p>
<p>My theory above can also be best-shown by looking at the mean Acousticness, Speachiness, Energy, and Danceability, over the two different albums using the code below:</p>
<div id="cb9fc3f1" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cleaned_df[cleaned_df[<span class="st">'ALBUM_NAME'</span>].<span class="bu">str</span>.contains(<span class="st">'untitled|DAMN.'</span>)]<span class="op">\</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        .groupby(<span class="st">'ALBUM_NAME'</span>)<span class="op">\</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        .aggregate(<span class="st">'mean'</span>, numeric_only<span class="op">=</span><span class="va">True</span>)<span class="op">\</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">filter</span>(items<span class="op">=</span>[<span class="st">'TRACK_ACOUSTICNESS'</span>, <span class="st">'TRACK_INSTRUMENTALNESS'</span>, <span class="st">'TRACK_SPEACHINESS'</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'TRACK_ENERGY'</span>, <span class="st">'TRACK_DANCEABILITY'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TRACK_ACOUSTICNESS</th>
<th data-quarto-table-cell-role="th">TRACK_INSTRUMENTALNESS</th>
<th data-quarto-table-cell-role="th">TRACK_SPEACHINESS</th>
<th data-quarto-table-cell-role="th">TRACK_ENERGY</th>
<th data-quarto-table-cell-role="th">TRACK_DANCEABILITY</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ALBUM_NAME</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">DAMN.</td>
<td>0.175444</td>
<td>0.006142</td>
<td>0.275729</td>
<td>0.584857</td>
<td>0.663000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">untitled unmastered.</td>
<td>0.442025</td>
<td>0.000001</td>
<td>0.328387</td>
<td>0.489625</td>
<td>0.638625</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="2306665f" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>table_data <span class="op">=</span> []</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> feature <span class="kw">in</span> [feat_num <span class="cf">for</span> feat_num <span class="kw">in</span> cleaned_df.select_dtypes(include<span class="op">=</span>[<span class="st">'int'</span>, <span class="st">'float'</span>]).columns<span class="op">\</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> feat_num <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'ALBUM_FRACTIONAL_DATE'</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_TIME_SIGNATURE'</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_KEY'</span>, <span class="st">'TRACK_MODE'</span>, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_TIME_SIGNATURE'</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'ANTI_DECAY_POPULARITY'</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'SCALED_DAYS_SINCE_RELEASE'</span>]]:</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    max_track <span class="op">=</span> cleaned_df[cleaned_df[feature] <span class="op">==</span> cleaned_df[feature].<span class="bu">max</span>()].get(<span class="st">'TRACK_NAME'</span>).values[<span class="dv">0</span>]</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    min_track <span class="op">=</span> cleaned_df[cleaned_df[feature] <span class="op">==</span> cleaned_df[feature].<span class="bu">min</span>()].get(<span class="st">'TRACK_NAME'</span>).values[<span class="dv">0</span>]</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    max_album <span class="op">=</span> cleaned_df[cleaned_df[<span class="st">'TRACK_NAME'</span>] <span class="op">==</span> max_track].get(<span class="st">'ALBUM_NAME'</span>).values[<span class="dv">0</span>]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    min_album <span class="op">=</span> cleaned_df[cleaned_df[<span class="st">'TRACK_NAME'</span>] <span class="op">==</span> min_track].get(<span class="st">'ALBUM_NAME'</span>).values[<span class="dv">0</span>]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Song with Max {feature.lower().split(sep='_')[1]}: {max_track}")</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(f"Song with Min {feature.lower().split(sep='_')[1]}: {min_track}")</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print("\n")</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decided to print out using a pretty tabulate format, instead of a general print statement.</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    table_data.append([feature, <span class="st">'Max'</span>, max_album, max_track])</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    table_data.append([feature, <span class="st">'Min'</span>, min_album, min_track])</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(table_data, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>               headers<span class="op">=</span>[<span class="st">'Feature'</span>, <span class="st">'Type'</span>, <span class="st">'Album Name'</span>, <span class="st">'Track Name'</span>], </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>               tablefmt<span class="op">=</span><span class="st">'pretty'</span>, stralign<span class="op">=</span><span class="st">'left'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----------------------------+------+-------------------------------+--------------------------------------+
| Feature                     | Type | Album Name                    | Track Name                           |
+-----------------------------+------+-------------------------------+--------------------------------------+
| TRACK_POPULARITY            | Max  | Not Like Us                   | Not Like Us                          |
| TRACK_POPULARITY            | Min  | good kid, m.A.A.d city        | Bitch, Don’t Kill My Vibe - Remix    |
| TRACK_DURATION_MS           | Max  | To Pimp A Butterfly           | Mortal Man                           |
| TRACK_DURATION_MS           | Min  | Section.80                    | Chapter Ten                          |
| TRACK_DANCEABILITY          | Max  | Section.80                    | Blow My High (Members Only)          |
| TRACK_DANCEABILITY          | Min  | To Pimp A Butterfly           | For Sale? - Interlude                |
| TRACK_ENERGY                | Max  | good kid, m.A.A.d city        | Compton                              |
| TRACK_ENERGY                | Min  | untitled unmastered.          | untitled 04 | 08.14.2014.            |
| TRACK_LOUDNESS              | Max  | Overly Dedicated              | Average Joe                          |
| TRACK_LOUDNESS              | Min  | untitled unmastered.          | untitled 04 | 08.14.2014.            |
| TRACK_SPEACHINESS           | Max  | To Pimp A Butterfly           | Mortal Man                           |
| TRACK_SPEACHINESS           | Min  | Mr. Morale &amp; The Big Steppers | Crown                                |
| TRACK_ACOUSTICNESS          | Max  | Section.80                    | Tammy's Song (Her Evils)             |
| TRACK_ACOUSTICNESS          | Min  | DAMN.                         | HUMBLE.                              |
| TRACK_INSTRUMENTALNESS      | Max  | DAMN.                         | BLOOD.                               |
| TRACK_INSTRUMENTALNESS      | Min  | Mr. Morale &amp; The Big Steppers | We Cry Together                      |
| TRACK_LIVENESS              | Max  | To Pimp A Butterfly           | i                                    |
| TRACK_LIVENESS              | Min  | Mr. Morale &amp; The Big Steppers | Worldwide Steppers                   |
| TRACK_VALENCE               | Max  | Section.80                    | Blow My High (Members Only)          |
| TRACK_VALENCE               | Min  | untitled unmastered.          | untitled 02 | 06.23.2014.            |
| TRACK_TEMPO                 | Max  | Overly Dedicated              | Opposites Attract (Tomorrow W/O Her) |
| TRACK_TEMPO                 | Min  | Section.80                    | Chapter Six                          |
| SCALED_ANTIDECAY_POPULARITY | Max  | good kid, m.A.A.d city        | Money Trees                          |
| SCALED_ANTIDECAY_POPULARITY | Min  | Mr. Morale &amp; The Big Steppers | Auntie Diaries                       |
+-----------------------------+------+-------------------------------+--------------------------------------+</code></pre>
</div>
</div>
<p>There’s quite a bit here, but nothing that we haven’t quite already examined in our plots of histograms. However, this is a good way to look at the extreme ends of our data points in a qualitative standpoint, instead of purely quantitatively.</p>
<div id="912bc894" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>album_pop_and_length <span class="op">=</span> cleaned_df.groupby([<span class="st">'ALBUM_FRACTIONAL_DATE'</span>, <span class="st">'ALBUM_NAME'</span>])<span class="op">\</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                        .aggregate(AVG_ALBUM_POPULARITY<span class="op">=</span>(<span class="st">'SCALED_ANTIDECAY_POPULARITY'</span>, <span class="st">'mean'</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                    AVG_ALBUM_DURATION<span class="op">=</span>(<span class="st">'TRACK_DURATION_MS'</span>, <span class="st">'mean'</span>))<span class="op">\</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                        .reset_index()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>lm_plot2 <span class="op">=</span> sns.lmplot(data<span class="op">=</span>album_pop_and_length, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                      x<span class="op">=</span><span class="st">'AVG_ALBUM_DURATION'</span>, y<span class="op">=</span><span class="st">'AVG_ALBUM_POPULARITY'</span>, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                      ci<span class="op">=</span><span class="dv">25</span>, robust<span class="op">=</span><span class="va">True</span>, aspect<span class="op">=</span><span class="dv">2</span>, height<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>lm_plot2.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Track's Duration Effect on Album Mean Relative Popularity </span><span class="ch">\n</span><span class="st">With Robust Regression"</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>plt.figtext(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="st">"Confidence Interval: 25"</span>, fontsize<span class="op">=</span><span class="dv">10</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-17-output-1.png" width="1142" height="679" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>What do we see now? Simply, on average, we see that Kendrick’s average album popularity tends to decrease as the average album duration increases.</p>
<div id="c258c2b9" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lm_plot3 <span class="op">=</span> sns.lmplot(data<span class="op">=</span>album_pop_and_length, </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                      x<span class="op">=</span><span class="st">'ALBUM_FRACTIONAL_DATE'</span>, y<span class="op">=</span><span class="st">'AVG_ALBUM_POPULARITY'</span>, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                      ci<span class="op">=</span><span class="dv">25</span>, robust<span class="op">=</span><span class="va">True</span>, aspect<span class="op">=</span><span class="dv">2</span>, height<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>lm_plot2.<span class="bu">set</span>(title<span class="op">=</span><span class="st">"Mean Relative Album Popularity Over Time </span><span class="ch">\n</span><span class="st">With Robust Regression"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>plt.figtext(<span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="st">"Confidence Interval: 25"</span>, fontsize<span class="op">=</span><span class="dv">10</span>, ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-18-output-1.png" width="1142" height="641" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Now, this plot above is a bit misleading. If reading it at face value, one would assume that over time, Kedrick is losing popularity. However, we must keep in mind that our y-value in this case, is relative. Moreover, a big part driving this decrease is because of the last 3 songs not having a lot of time to really yet be established as truly popular or not, given our anti-decay formula. Lastly, since the value is relative, we also get the “negative” impact of ‘Mr.&nbsp;Morale &amp; The Big Steppers’ being the lowest and after 2022.</p>
<p>For reference, if I had plotted (not shown) the same plot but using the original popularity value, the line was VERY linearly positive. Which we would expect since the original popularity rating was developed that way!</p>
<p>With that, that concludes this section of our code, let’s dive into some machine learning algorithms now!</p>
</section>
</section>
<section id="machine-learning-models" class="level1">
<h1>Machine Learning Models</h1>
<p>For this specific section, we’re going to our data a bit and build some machine learning models to try and see if it can accurately predict whether I (personally) would REALLY like a Kedrick Lamar song, or not so much.</p>
<p>This will be using manually imputted values of 1 on songs I really enjoy, and 0 on songs I did not enjoy as much.</p>
<p>Though the above is a classification model, the same can be done using regressions models using a “likeness” value from 0 to 100, for example!</p>
<div id="0adef99f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's first manually categorize whether we VERY MUCH like a Kendrick Lamar song</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or not so much. We skip this in our iteration, and use the harded values instead.</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>favorites <span class="op">=</span> {}</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, row <span class="kw">in</span> cleaned_df.iterrows():</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    song <span class="op">=</span> row[<span class="st">'TRACK_NAME'</span>]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    is_favorite <span class="op">=</span> simpledialog.askinteger(<span class="st">'Song Categorizer'</span>, </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>                            prompt<span class="op">=</span><span class="ss">f'Do you like song: </span><span class="sc">{</span>song<span class="sc">}</span><span class="ss">: 0 or 1'</span>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    favorites[song] <span class="op">=</span> is_favorite</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="610247b7" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To not have to cycle through again, I will hardcore the results below</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>favorites <span class="op">=\</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">'Alright'</span>: <span class="dv">1</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Silent Hill'</span>: <span class="dv">0</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Count Me Out'</span>: <span class="dv">0</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Not Like Us'</span>: <span class="dv">1</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'meet the grahams'</span>: <span class="dv">1</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'A.D.H.D'</span>: <span class="dv">1</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'FEEL.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'HiiiPower'</span>: <span class="dv">0</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Rich Spirit'</span>: <span class="dv">1</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'ELEMENT.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'euphoria'</span>: <span class="dv">1</span>,</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'LOYALTY. FEAT. RIHANNA.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'These Walls'</span>: <span class="dv">0</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'N95'</span>: <span class="dv">1</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Father Time (feat. Sampha)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'FEAR.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 08 | 09.06.2014.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'DUCKWORTH.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Savior'</span>: <span class="dv">1</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'King Kunta'</span>: <span class="dv">1</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'Purple Hearts'</span>: <span class="dv">0</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'PRIDE.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'LUST.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'We Cry Together'</span>: <span class="dv">1</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a> <span class="st">"Hol' Up"</span>: <span class="dv">0</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'Die Hard'</span>: <span class="dv">1</span>,</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'Chapter Six'</span>: <span class="dv">0</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a> <span class="st">'XXX. FEAT. U2.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a> <span class="st">'HUMBLE.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a> <span class="st">"Wesley's Theory"</span>: <span class="dv">1</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a> <span class="st">'YAH.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a> <span class="st">'LOVE. FEAT. ZACARI.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a> <span class="st">'Money Trees'</span>: <span class="dv">1</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a> <span class="st">'DNA.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a> <span class="st">'United In Grief'</span>: <span class="dv">1</span>,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a> <span class="st">'Mr. Morale'</span>: <span class="dv">0</span>,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a> <span class="st">'BLOOD.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a> <span class="st">'m.A.A.d city'</span>: <span class="dv">1</span>,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a> <span class="st">'Bitch, Don’t Kill My Vibe'</span>: <span class="dv">1</span>,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a> <span class="st">'The Heart Part 5'</span>: <span class="dv">1</span>,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a> <span class="st">'Blow My High (Members Only)'</span>: <span class="dv">0</span>,</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a> <span class="st">'u'</span>: <span class="dv">1</span>,</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a> <span class="st">'Rigamortus'</span>: <span class="dv">0</span>,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a> <span class="st">'Mother I Sober (feat. Beth Gibbons of Portishead)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a> <span class="st">'How Much A Dollar Cost'</span>: <span class="dv">0</span>,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a> <span class="st">'The Blacker The Berry'</span>: <span class="dv">1</span>,</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a> <span class="st">'Hood Politics'</span>: <span class="dv">1</span>,</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 02 | 06.23.2014.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 03 | 05.28.2013.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a> <span class="st">'Poe Mans Dreams (His Vice) (feat. GLC)'</span>: <span class="dv">0</span>,</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a> <span class="st">'Institutionalized'</span>: <span class="dv">0</span>,</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a> <span class="st">'Momma'</span>: <span class="dv">1</span>,</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a> <span class="st">'Ronald Reagan Era'</span>: <span class="dv">0</span>,</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 07 | 2014 - 2016'</span>: <span class="dv">1</span>,</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a> <span class="st">"You Ain't Gotta Lie (Momma Said)"</span>: <span class="dv">1</span>,</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a> <span class="st">'Complexion (A Zulu Love)'</span>: <span class="dv">0</span>,</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a> <span class="st">'GOD.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a> <span class="st">'i'</span>: <span class="dv">1</span>,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 06 | 06.30.2014.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a> <span class="st">'Mirror'</span>: <span class="dv">0</span>,</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a> <span class="st">'Mortal Man'</span>: <span class="dv">1</span>,</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a> <span class="st">'For Free? - Interlude'</span>: <span class="dv">0</span>,</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a> <span class="st">'Auntie Diaries'</span>: <span class="dv">0</span>,</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a> <span class="st">'Rich - Interlude'</span>: <span class="dv">0</span>,</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 05 | 09.21.2014.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a> <span class="st">"Tammy's Song (Her Evils)"</span>: <span class="dv">1</span>,</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a> <span class="st">'Crown'</span>: <span class="dv">0</span>,</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a> <span class="st">'Worldwide Steppers'</span>: <span class="dv">0</span>,</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a> <span class="st">'F*ck Your Ethnicity'</span>: <span class="dv">1</span>,</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a> <span class="st">"Sing About Me, I'm Dying Of Thirst"</span>: <span class="dv">1</span>,</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a> <span class="st">'Swimming Pools (Drank) - Extended Version'</span>: <span class="dv">1</span>,</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a> <span class="st">'For Sale? - Interlude'</span>: <span class="dv">0</span>,</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a> <span class="st">'Backseat Freestyle'</span>: <span class="dv">1</span>,</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a> <span class="st">'Savior - Interlude'</span>: <span class="dv">1</span>,</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a> <span class="st">'Poetic Justice'</span>: <span class="dv">1</span>,</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a> <span class="st">'Opposites Attract (Tomorrow W/O Her)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a> <span class="st">'Kush &amp; Corinthians (feat. BJ The Chicago Kid)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a> <span class="st">'Average Joe'</span>: <span class="dv">1</span>,</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a> <span class="st">'Cut You Off (To Grow Closer)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a> <span class="st">'She Needs Me (Remix)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a> <span class="st">'Michael Jordan'</span>: <span class="dv">0</span>,</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a> <span class="st">'P&amp;P 1.5'</span>: <span class="dv">0</span>,</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a> <span class="st">'Growing Apart (To Get Closer)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a> <span class="st">'H.O.C'</span>: <span class="dv">0</span>,</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a> <span class="st">'Ignorance Is Bliss'</span>: <span class="dv">0</span>,</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a> <span class="st">"Keisha's Song (Her Pain) (feat. Ashtro Bot)"</span>: <span class="dv">1</span>,</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a> <span class="st">'R.O.T.C (Interlude)'</span>: <span class="dv">0</span>,</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a> <span class="st">'Chapter Ten'</span>: <span class="dv">0</span>,</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a> <span class="st">'Barbed Wire'</span>: <span class="dv">1</span>,</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a> <span class="st">'No Make-Up (Her Vice) (feat. Colin Munroe)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 04 | 08.14.2014.'</span>: <span class="dv">0</span>,</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a> <span class="st">'Alien Girl (Today W/ Her)'</span>: <span class="dv">1</span>,</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a> <span class="st">'The Art of Peer Pressure'</span>: <span class="dv">1</span>,</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a> <span class="st">'untitled 01 | 08.19.2014.'</span>: <span class="dv">1</span>,</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a> <span class="st">'Ab-Souls Outro (feat. Ab-Soul)'</span>: <span class="dv">0</span>,</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a> <span class="st">'Bitch, Don’t Kill My Vibe - Remix'</span>: <span class="dv">0</span>,</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a> <span class="st">'good kid'</span>: <span class="dv">1</span>,</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a> <span class="st">'Real'</span>: <span class="dv">1</span>,</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a> <span class="st">'Compton'</span>: <span class="dv">1</span>,</span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a> <span class="st">'Sherane a.k.a Master Splinter’s Daughter'</span>: <span class="dv">1</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="26b45f04" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cleaned_df[<span class="st">'IS_FAVORITE'</span>] <span class="op">=</span> favorites.values()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cleaned_df.groupby(<span class="st">'IS_FAVORITE'</span>).size() <span class="co"># Check class imbalanced</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>IS_FAVORITE
0    39
1    61
dtype: int64</code></pre>
</div>
</div>
<p>Now, our target variable isn’t grossly inbalaned, but there is some inbalance nonetheless.</p>
<p>Let’s try and correct for that by manually some potentially repetitive songs (Remix versions), for example. Any additional differences, will have to be handled differently. Whether we use weights for the classes, undersampling, or SMOTE for oversampling.</p>
<p>Though we will use some models that this inbalance does not matter as much (like random forest), it should still be corrected for the best approaches.</p>
<p>We are also going to drop unneeded columns and scale all values for learning models before we begin.</p>
<div id="a5f99d77" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicated songs was just 1</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>songs_to_drop <span class="op">=</span> [<span class="st">'Bitch, Don’t Kill My Vibe - Remix'</span>]</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's drop that row, and all unneeded columns now.</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>df_ML <span class="op">=</span> cleaned_df[<span class="op">~</span>cleaned_df[<span class="st">'TRACK_NAME'</span>].isin(songs_to_drop)]<span class="op">\</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        .drop(columns<span class="op">=</span>[<span class="st">'ALBUM_ID'</span>, <span class="st">'ALBUM_NAME'</span>, <span class="st">'ALBUM_RELEASE_DATE'</span>,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'TRACK_ID'</span>, <span class="st">'TRACK_POPULARITY'</span>, <span class="st">'ALBUM_FRACTIONAL_DATE'</span>])<span class="op">\</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        .reset_index(drop<span class="op">=</span><span class="va">True</span>)<span class="op">\</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        .assign(<span class="op">**</span>pd.get_dummies(data<span class="op">=</span>cleaned_df[[<span class="st">'TRACK_KEY'</span>, <span class="st">'TRACK_MODE'</span>, </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_TIME_SIGNATURE'</span>]], </span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>                                drop_first<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>                                 columns<span class="op">=</span>[<span class="st">'TRACK_KEY'</span>, <span class="st">'TRACK_MODE'</span>, </span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_TIME_SIGNATURE'</span>]))<span class="op">\</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        .drop(columns<span class="op">=</span>[<span class="st">'TRACK_KEY'</span>, <span class="st">'TRACK_MODE'</span>, </span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">'TRACK_TIME_SIGNATURE'</span>])</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>df_ML <span class="op">=</span> df_ML.reindex(columns<span class="op">=</span>[<span class="st">'TRACK_NAME'</span>] <span class="op">+\</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>                      [col <span class="cf">for</span> col <span class="kw">in</span> df_ML.columns <span class="cf">if</span> col <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'IS_FAVORITE'</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>                                                                    <span class="st">'TRACK_NAME'</span>]] <span class="op">+\</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>                                                                 [<span class="st">'IS_FAVORITE'</span>]</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>df_og <span class="op">=</span> df_ML.copy() <span class="co">#Will be used for index values later on.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This pairplot below is just used as a quick spot-check analysis since we already performed an extensive EDA on all of the features against the ranking of the song.</p>
<p>So, what do I infer from it? I would assume our predictive modeling abilities will be akin to that of a coin flip, or perhaps a bit better, at most. However, we will still run through several examples, I would feel relatively confident saying we would need more data or better features.</p>
<p>Why do I infer that? I do so because when looking at all the scatter plots, none have a very clear seperation between the classes. Furthermore, when looking at the density plot (diagonals), we can see that each class (0 and 1) can be very easily sub-sampled from the other in a random sampling.</p>
<div id="97cb3bb2" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sns.pairplot(df_ML.select_dtypes([<span class="bu">int</span>, <span class="bu">float</span>]), hue<span class="op">=</span><span class="st">'IS_FAVORITE'</span>).add_legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-23-output-1.png" width="3277" height="3063" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="data-splitting" class="level2">
<h2 class="anchored" data-anchor-id="data-splitting">Data Splitting</h2>
<div id="d1d16d10" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First things first, we need to split the data. Then we will standardize after</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to avoid data leakage.</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_ML.drop(columns<span class="op">=</span>[<span class="st">'TRACK_NAME'</span>, <span class="st">'IS_FAVORITE'</span>])</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_ML[<span class="st">'IS_FAVORITE'</span>]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                                                    test_size<span class="op">=</span><span class="fl">0.3</span>, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                                                    random_state<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scaling-the-data" class="level2">
<h2 class="anchored" data-anchor-id="scaling-the-data">Scaling The Data</h2>
<div id="c31437b5" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can scale the data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cols_to_scale <span class="op">=</span> [<span class="st">'TRACK_DURATION_MS'</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_DANCEABILITY'</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_ENERGY'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_LOUDNESS'</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_SPEACHINESS'</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_ACOUSTICNESS'</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_INSTRUMENTALNESS'</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_LIVENESS'</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_VALENCE'</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">'TRACK_TEMPO'</span>]</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train[cols_to_scale])</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test[cols_to_scale])</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's keep it in pandas dataframe for better visuals</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>X_train_scaled_df <span class="op">=</span> pd.DataFrame(X_train_scaled, columns<span class="op">=</span>cols_to_scale, index<span class="op">=</span>X_train.index)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>X_test_scaled_df <span class="op">=</span> pd.DataFrame(X_test_scaled, columns<span class="op">=</span>cols_to_scale, index<span class="op">=</span>X_test.index)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>X_train_final <span class="op">=</span> pd.concat([X_train_scaled_df, X_train.drop(columns<span class="op">=</span>cols_to_scale <span class="op">+</span> [<span class="st">'DAYS_SINCE_RELEASE'</span>])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>X_test_final <span class="op">=</span> pd.concat([X_test_scaled_df, X_test.drop(columns<span class="op">=</span>cols_to_scale <span class="op">+</span> [<span class="st">'DAYS_SINCE_RELEASE'</span>])], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>y_train_final <span class="op">=</span> pd.DataFrame(y_train)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>y_test_final <span class="op">=</span> pd.DataFrame(y_test)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> pd.option_context(<span class="st">'display.max_columns'</span>, <span class="va">None</span>): </span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    display(X_train_final.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TRACK_DURATION_MS</th>
<th data-quarto-table-cell-role="th">TRACK_DANCEABILITY</th>
<th data-quarto-table-cell-role="th">TRACK_ENERGY</th>
<th data-quarto-table-cell-role="th">TRACK_LOUDNESS</th>
<th data-quarto-table-cell-role="th">TRACK_SPEACHINESS</th>
<th data-quarto-table-cell-role="th">TRACK_ACOUSTICNESS</th>
<th data-quarto-table-cell-role="th">TRACK_INSTRUMENTALNESS</th>
<th data-quarto-table-cell-role="th">TRACK_LIVENESS</th>
<th data-quarto-table-cell-role="th">TRACK_VALENCE</th>
<th data-quarto-table-cell-role="th">TRACK_TEMPO</th>
<th data-quarto-table-cell-role="th">SCALED_DAYS_SINCE_RELEASE</th>
<th data-quarto-table-cell-role="th">ANTI_DECAY_POPULARITY</th>
<th data-quarto-table-cell-role="th">SCALED_ANTIDECAY_POPULARITY</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_1</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_2</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_3</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_4</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_5</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_6</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_7</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_8</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_9</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_10</th>
<th data-quarto-table-cell-role="th">TRACK_KEY_11</th>
<th data-quarto-table-cell-role="th">TRACK_MODE_1</th>
<th data-quarto-table-cell-role="th">TRACK_TIME_SIGNATURE_3</th>
<th data-quarto-table-cell-role="th">TRACK_TIME_SIGNATURE_4</th>
<th data-quarto-table-cell-role="th">TRACK_TIME_SIGNATURE_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0.165911</td>
<td>1.122719</td>
<td>-1.565181</td>
<td>-0.016192</td>
<td>-1.472388</td>
<td>1.621521</td>
<td>-0.191745</td>
<td>-0.611989</td>
<td>0.165433</td>
<td>0.588869</td>
<td>0.144951</td>
<td>80.258014</td>
<td>24.709615</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">88</td>
<td>-0.221561</td>
<td>-0.421087</td>
<td>-0.523470</td>
<td>-1.668265</td>
<td>0.919404</td>
<td>0.082846</td>
<td>-0.191745</td>
<td>-0.967774</td>
<td>-1.906121</td>
<td>-0.397300</td>
<td>0.598876</td>
<td>71.010070</td>
<td>11.719123</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">64</td>
<td>0.491294</td>
<td>0.673066</td>
<td>-1.197519</td>
<td>-0.095939</td>
<td>0.911787</td>
<td>-0.787604</td>
<td>-0.189854</td>
<td>1.811867</td>
<td>-1.089245</td>
<td>-1.267178</td>
<td>0.845613</td>
<td>83.443516</td>
<td>29.184258</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26</td>
<td>-0.353683</td>
<td>1.677290</td>
<td>-0.931984</td>
<td>-0.742644</td>
<td>-0.611648</td>
<td>-0.229285</td>
<td>-0.191572</td>
<td>-0.821590</td>
<td>1.185193</td>
<td>0.154985</td>
<td>0.598876</td>
<td>93.200717</td>
<td>42.890100</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>0.002388</td>
<td>-1.650137</td>
<td>0.933563</td>
<td>0.761044</td>
<td>1.125067</td>
<td>-0.185323</td>
<td>-0.191745</td>
<td>1.043327</td>
<td>0.619253</td>
<td>-1.347320</td>
<td>0.669946</td>
<td>92.985154</td>
<td>42.587301</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div id="17d21961" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>best_rf <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>best_rf_accuracy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>best_rf_predict <span class="op">=</span> <span class="va">None</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> est <span class="kw">in</span> [<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>]:</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    rf <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span>est, </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                                class_weight<span class="op">=</span><span class="st">'balanced'</span>, </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                                random_state<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    rf.fit(X_train_final, y_train_final.to_numpy().ravel())</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    rf_predict <span class="op">=</span> rf.predict(X_test_final)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    rf_balanced_accuracy <span class="op">=</span> balanced_accuracy_score(y_test_final, rf_predict)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>  rf_balanced_accuracy <span class="op">&gt;</span> best_rf_accuracy:</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        best_rf_accuracy <span class="op">=</span> rf_balanced_accuracy</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        best_rf_predict <span class="op">=</span> rf_predict</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        best_rf <span class="op">=</span> rf</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Num of estimators: '</span>, best_rf.n_estimators)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Best Score: '</span>, best_rf_accuracy)</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>rf_conf_matrix <span class="op">=</span> confusion_matrix(y_test_final, best_rf_predict)</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>sns.heatmap(rf_conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Labels'</span>)</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual Labels'</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Num of estimators:  50
Best Score:  0.4444444444444444</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-26-output-2.png" width="614" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="f91d9e9a" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary of features and their importances</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>feature_importance_dict <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(best_rf.feature_names_in_, best_rf.feature_importances_))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort the dictionary by importances in descending order</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>sorted_feature_importance <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">sorted</span>(feature_importance_dict.items(), key<span class="op">=</span><span class="kw">lambda</span> item: item[<span class="dv">1</span>], reverse<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the sorted feature importances</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.bar(sorted_feature_importance.keys(), sorted_feature_importance.values(), color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Features'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Importance'</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Feature Importance Sorted'</span>)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-27-output-1.png" width="597" height="661" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<div id="075611bf" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>logit <span class="op">=</span> LogisticRegression(class_weight<span class="op">=</span><span class="st">'balanced'</span>, random_state<span class="op">=</span><span class="dv">5</span>, max_iter<span class="op">=</span><span class="dv">1_000</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>logit.fit(X_train_final, y_train_final.to_numpy().ravel())</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>logit_predict <span class="op">=</span> logit.predict(X_test_final)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test_final, logit_predict)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, logit_predict))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Labels'</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual Labels'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.30      0.25      0.27        12
           1       0.55      0.61      0.58        18

    accuracy                           0.47        30
   macro avg       0.43      0.43      0.43        30
weighted avg       0.45      0.47      0.46        30
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-28-output-2.png" width="614" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="multi-layer-perceptron" class="level2">
<h2 class="anchored" data-anchor-id="multi-layer-perceptron">Multi-Layer Perceptron</h2>
<div id="8c59ec91" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mlp <span class="op">=</span> MLPClassifier(hidden_layer_sizes<span class="op">=</span> (<span class="dv">3</span>, <span class="dv">20</span>), activation<span class="op">=</span><span class="st">'relu'</span>, random_state<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mlp.fit(X_train_final, y_train_final.to_numpy().ravel())</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mlp_predict <span class="op">=</span> mlp.predict(X_test_final)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test_final, mlp_predict)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test_final, mlp_predict))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>balanced_accuracy_score(y_test_final, mlp_predict)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Labels'</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual Labels'</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.00      0.00      0.00        12
           1       0.60      1.00      0.75        18

    accuracy                           0.60        30
   macro avg       0.30      0.50      0.38        30
weighted avg       0.36      0.60      0.45        30
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-29-output-2.png" width="614" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="k-nearest-neighbors" class="level2">
<h2 class="anchored" data-anchor-id="k-nearest-neighbors">K-Nearest Neighbors</h2>
<div id="6d147300" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>neighbors_and_accuracy <span class="op">=</span> {}</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>best_knn <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>best_knn_accuracy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>best_knn_predict <span class="op">=</span> <span class="va">None</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="dv">20</span>):</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    knn <span class="op">=</span> KNeighborsClassifier(n_neighbors<span class="op">=</span>i, weights<span class="op">=</span><span class="st">'uniform'</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    knn.fit(X_train_final, y_train_final.to_numpy().ravel())</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    knn_predict <span class="op">=</span> knn.predict(X_test_final)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    knn_clf_score <span class="op">=</span> balanced_accuracy_score(y_test_final, knn_predict)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    neighbors_and_accuracy.setdefault(i, knn_clf_score)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> knn_clf_score <span class="op">&gt;</span> best_knn_accuracy:</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>        best_knn_accuracy <span class="op">=</span> knn_clf_score</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>        best_knn <span class="op">=</span> knn</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>        best_knn_predict <span class="op">=</span> knn_predict</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sns.lineplot(x<span class="op">=</span>neighbors_and_accuracy.keys(), y<span class="op">=</span>neighbors_and_accuracy.values())</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>fig.set_xlabel(<span class="st">'K Neighbors'</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>fig.set_ylabel(<span class="st">'Balanced Accuracy Score'</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Max Balanced Accuracy : </span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Neighbors: </span><span class="sc">{</span>best_knn<span class="sc">.</span>n_neighbors<span class="sc">}</span><span class="ss">,</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"Accuracy </span><span class="sc">{</span>best_knn_accuracy<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-30-output-1.png" width="606" height="429" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Max Balanced Accuracy : 
Neighbors: 2,
Accuracy 0.58</code></pre>
</div>
</div>
<div id="dc46f63a" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KNN Confusion Matrix</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_test_final, best_knn_predict)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test_final, best_knn_predict))</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot confusion matrix</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>sns.heatmap(conf_matrix, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted Labels'</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Actual Labels'</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Confusion Matrix'</span>)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.47      0.67      0.55        12
           1       0.69      0.50      0.58        18

    accuracy                           0.57        30
   macro avg       0.58      0.58      0.57        30
weighted avg       0.60      0.57      0.57        30
</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Project_Main_files/figure-html/cell-31-output-2.png" width="606" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="closing-thoughts" class="level1">
<h1>Closing Thoughts</h1>
<p>Which songs did our best model get correct? <br> Since KNN was our best model as far as balanced accuracy score, let’s see exactly which songs it guess correctled/incorrectly, instead of just random indices and values.</p>
<div id="876076da" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>song_analysis <span class="op">=</span> df_og[[<span class="st">'TRACK_NAME'</span>, <span class="st">'IS_FAVORITE'</span>]].iloc[X_test_final.index,]<span class="op">\</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                .assign(CLF_IS_FAVORITE <span class="op">=</span> best_knn_predict,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                        IS_MATCH <span class="op">=</span> <span class="kw">lambda</span> df: df[<span class="st">'CLF_IS_FAVORITE'</span>] <span class="op">==</span> df[<span class="st">'IS_FAVORITE'</span>])<span class="op">\</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                .sort_values(<span class="st">'IS_MATCH'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>song_analysis</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">TRACK_NAME</th>
<th data-quarto-table-cell-role="th">IS_FAVORITE</th>
<th data-quarto-table-cell-role="th">CLF_IS_FAVORITE</th>
<th data-quarto-table-cell-role="th">IS_MATCH</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">66</td>
<td>Institutionalized</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">97</td>
<td>Barbed Wire</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">55</td>
<td>Hood Politics</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">71</td>
<td>Poetic Justice</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">63</td>
<td>Rich - Interlude</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>These Walls</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">56</td>
<td>untitled 05 | 09.21.2014.</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">60</td>
<td>i</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>Rigamortus</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>Bitch, Don’t Kill My Vibe</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>Hol' Up</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>Mr. Morale</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>LOYALTY. FEAT. RIHANNA.</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">28</td>
<td>Wesley's Theory</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">87</td>
<td>untitled 04 | 08.14.2014.</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>XXX. FEAT. U2.</td>
<td>0</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>LOVE. FEAT. ZACARI.</td>
<td>1</td>
<td>1</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">32</td>
<td>YAH.</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>untitled 07 | 2014 - 2016</td>
<td>0</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">57</td>
<td>Auntie Diaries</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Rich Spirit</td>
<td>0</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">69</td>
<td>Crown</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">70</td>
<td>Tammy's Song (Her Evils)</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>Purple Hearts</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">39</td>
<td>Mortal Man</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>HUMBLE.</td>
<td>0</td>
<td>1</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>FEEL.</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">74</td>
<td>For Sale? - Interlude</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>How Much A Dollar Cost</td>
<td>1</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">94</td>
<td>good kid</td>
<td>0</td>
<td>1</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>What are my final thoughts? Basically a coin flip (though maybe a little better). Though, credit where credit is due, I am honestly impressed at the accuracy given the incredible risk/error my personal opinion of whether a song was a favorite of mine or not. Something as simple as taking my own quiz at a later time would surely end in different results. So, my own predict variable would be hard to re-create, thus, a machine learning model would struggle because it is not privy to my own internal thought process in whether a song is truly a favorite or not. However, as mentioned, given that and the features, it is still able to calculate a remarkable accuracy despite this enourmous hurlde.</p>
<p>What I am dissappointed in, is some of the songs it guessed as favorites when it wasn’t a true favorite. However, those songs have A LOT of similarities with songs I do love when I think back to the songs.</p>
<p>Additionally, this goes to show that it’s not just the quantifiable features, but it may also do with the words in the specific words. This would require a NLP lyrical-analysis though, which is beyond the scope of this specific project. But perhaps something for a future one.</p>
<p>Lastly, some songs I did like, but aren’t a huge favorite. So, just as much as the model “is the problem” I was also problem that was introduced into the equation with perhaps a hard-to-reproduce scaling system.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>